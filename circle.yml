---
machine:
  ruby:
    version: '2.2.4'
dependencies:
  pre:
  - echo sudo apt-get update
  - echo sudo apt-get install libpango1.0-0
  - echo sudo apt-get install firefox
  cache_directories:
  - test/fixtures/profiles
  - test/fixtures/plugins
test:
  override:
  - ? |-
      case $CIRCLE_NODE_INDEX in
        0)  JURISM=false CIRCLE_TESTS="--tag ~@noci --tag @test-cluster-1" bundle exec rake test
            ;;
        1)  JURISM=false CIRCLE_TESTS="--tag ~@noci --tag ~@test-cluster-1" bundle exec rake test
            ;;
        2)  JURISMBETA=true  CIRCLE_TESTS="--tag ~@noci --tag @test-cluster-1" bundle exec rake test
            ;;
        *)  JURISMBETA=true  CIRCLE_TESTS="--tag ~@noci --tag ~@test-cluster-1" bundle exec rake test
            ;;
      esac
      find . -type f -empty -delete
      mv *.debug *.log $CIRCLE_ARTIFACTS || echo 'no log artifacts'
    : parallel: true
general:
  branches:
    ignore:
      - gh-pages
deployment:
  all:
    branch: "/.*/"
    commands:
    - find . -name vendor -prune -o -name test -prune -o -name .git -prune -o -name wiki -prune -o -name node_modules -prune -o -type f
    - bundle exec rake publish
