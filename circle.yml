machine:
  ruby:
    version: "2.2"
  environment:
    CIRCLE_USERNAME: retorquere
dependencies:
  pre:
    - sudo apt-get update; sudo apt-get install 7z
  cache_directories:
    - "bin"
    - test/fixtures/profiles
test:
  override:
    - bundle exec rake test:
        parallel: true
deployment:
  master:
    branch: master
    commands:
      - git submodule update --init
      - cd www; git checkout master; git pull
      - git config --global user.name "$CIRCLE_USERNAME"
      - git config --global user.email "$CIRCLE_USERNAME@$CIRCLE_PROJECT_USERNAME.github.com"
      - git config --global push.default matching
      - git config -l
      - mv cucumber.status cucumber.0.status
      - scp node1:zotero-better-bibtex/cucumber.status cucumber.1.status
      - scp node2:zotero-better-bibtex/cucumber.status cucumber.2.status
      - scp node3:zotero-better-bibtex/cucumber.status cucumber.3.status
      - bundle exec rake deploy
